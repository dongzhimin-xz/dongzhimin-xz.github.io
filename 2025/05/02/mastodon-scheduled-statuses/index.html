<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="长毛象定时发文"><meta name="keywords" content="言论自由只在这里,爱🐘TV,超长代码预警,非保姆级教程,哈基象欠爱了,长毛象前端,非基础,长毛象计划发嘟"><meta name="author" content="妙瓦草,undefined"><meta name="copyright" content="妙瓦草"><meta name="fediverse:creator" content="@Network@cmx.dzm.pp.ua"><link rel="me" href="https://cmx.dzm.pp.ua/@Network"><title>长毛象定时发文【妙瓦种子】</title><link rel="stylesheet" href="../../../../css/fan.css"><link rel="stylesheet" href="../../../../css/thirdparty/jquery.mCustomScrollbar.min.css"><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"><link rel="icon" href="../../../../favicon.ico"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch-theme-algolia.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4"></script><!-- link(rel="dns-prefetch" href="https://cdn.jsdelivr.net")--><!-- link(rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css")--><!-- script(src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer)--><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- script(src=url_for("/js/mathjax/mathjax.js"))--><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
});
</script><script>var isPassword = '' || false;
if (isPassword) {
    if (prompt('请输入文章密码') !== '') {
        alert('密码错误！');
        history.back();
    }
}</script><script>window.GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"BLFJMI3OZT","apiKey":"bfca30d788c8947af1865ed33655b646","indexName":"blog","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  gitment: {},
  valine: {"appId":"xASAWVJMlgR6Z0IAumJosLmQ-MdYXbMMI","appKey":"hrSzqoj09CVByDzUeBMDEjuF","serverURLs":"https://xasawvjm.api.lncldglobal.com"},
  twikoo: {},
}</script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="atom.xml" title="妙瓦种子" type="application/atom+xml">
</head><body><canvas id="universe"></canvas><!--#body--><div id="sidebar"><div class="toggle-sidebar-info button-hover"><span data-toggle="文章目录">站点概览</span></div><div class="sidebar-toc"><div class="sidebar-toc-title">目录</div><div class="sidebar-toc-progress"><span class="progress-notice">您已阅读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc-progress-bar"></div></div><div class="sidebar-toc-content" id="sidebar-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF"><span class="toc-number">1.</span> <span class="toc-text">需求背景</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#FediPlan"><span class="toc-number">1.1.</span> <span class="toc-text">FediPlan</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%98%9F%E6%96%87%E5%8F%91%E9%80%81%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">嘟文发送的基本原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Redux%E7%9A%84%E9%80%BB%E8%BE%91%E6%B5%85%E6%9E%90"><span class="toc-number">2.1.</span> <span class="toc-text">Redux的逻辑浅析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E9%AD%94%E6%94%B9"><span class="toc-number">3.</span> <span class="toc-text">代码魔改</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%95%BF%E6%AF%9B%E8%B1%A1%E4%B8%BB%E9%A2%98%E7%9A%84%E4%BF%AE%E6%94%B9"><span class="toc-number">4.</span> <span class="toc-text">长毛象主题的修改</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%93%E8%AF%AD"><span class="toc-number">5.</span> <span class="toc-text">结语</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info-avatar"><img class="author-info-avatar-img" src="/avatar.jpg"></div><div class="author-info-name">妙瓦草</div><div class="author-info-description"></div><div class="links-buttons"><a class="links-button button-hover" href="https://github.com/dongzhimin-xz" target="_blank">GitHub<i class="icon-dot bg-color9"></i></a><a class="links-button button-hover" href="https://cmx.dzm.pp.ua/@Network" target="_blank">长毛象<i class="icon-dot bg-color3"></i></a><a class="links-button button-hover" href="https://bsky.app/profile/dzm.pp.ua" target="_blank">BlueSky<i class="icon-dot bg-color3"></i></a></div><div class="author-info-articles"><a class="author-info-articles-archives article-meta" href="../../../../archives"><span class="pull-top">日志</span><span class="pull-bottom">13</span></a><a class="author-info-articles-tags article-meta" href="../../../../tags"><span class="pull-top">标签</span><span class="pull-bottom">22</span></a><a class="author-info-articles-categories article-meta" href="../../../../categories"><span class="pull-top">分类</span><span class="pull-bottom">21</span></a></div><div class="friend-link"><a class="friend-link-text" href="https://dzm.pp.ua/" target="_blank">个人主页</a><a class="friend-link-text" href="https://cmx.dzm.pp.ua/" target="_blank">长毛象实例</a></div></div></div><div id="main-container"><header><div id="menu-outer"><i class="menu-list-icon fas fa-bars"></i><nav id="menu-inner"><a class="menu-item" href="/">首页</a><a class="menu-item" href="/tags">标签</a><a class="menu-item" href="/categories">分类</a><a class="menu-item" href="/archives">归档</a><a class="menu-item" href="/about">关于</a></nav><div class="right-info"><a class="search social-icon"><i class="fas fa-search"></i><span> 搜索</span></a><a class="title-name" href="/">妙瓦种子</a><span id="now-time"></span></div></div></header><div id="content-outer"><div id="content-inner"><article id="post"><div class="post-header"><div class="title">长毛象定时发文</div><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 发表于 2025-05-02 | 更新于 2025-05-18</time><!--time.button-hover.post-date #[i.fas.fa-calendar-alt.article-icon(aria-hidden="true")] #[=__('post.modified')] #[=date(page['updated'], config.date_format)]--><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="../../../../categories/%E5%BB%BA%E7%AB%99%E6%8A%80%E6%9C%AF/">建站技术</a><i class="fa fa-angle-right" style="margin: 0 8px;"></i><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="../../../../categories/%E5%BB%BA%E7%AB%99%E6%8A%80%E6%9C%AF/%E9%95%BF%E6%AF%9B%E8%B1%A1%E9%87%8D%E5%BA%A6%E9%AD%94%E6%94%B9/">长毛象重度魔改</a><i class="fa fa-angle-right" style="margin: 0 8px;"></i><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="../../../../categories/%E5%BB%BA%E7%AB%99%E6%8A%80%E6%9C%AF/%E9%95%BF%E6%AF%9B%E8%B1%A1%E9%87%8D%E5%BA%A6%E9%AD%94%E6%94%B9/%E9%95%BF%E6%AF%9B%E8%B1%A1%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">长毛象前端开发</a><i class="fa fa-angle-right" style="margin: 0 8px;"></i><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="../../../../categories/%E5%BB%BA%E7%AB%99%E6%8A%80%E6%9C%AF/%E9%95%BF%E6%AF%9B%E8%B1%A1%E9%87%8D%E5%BA%A6%E9%AD%94%E6%94%B9/%E9%95%BF%E6%AF%9B%E8%B1%A1%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/%E9%95%BF%E6%AF%9B%E8%B1%A1%E5%AE%9A%E6%97%B6%E5%8F%91%E6%96%87/">长毛象定时发文</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="../../../../tags/%E8%A8%80%E8%AE%BA%E8%87%AA%E7%94%B1%E5%8F%AA%E5%9C%A8%E8%BF%99%E9%87%8C/">言论自由只在这里</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="../../../../tags/%E7%88%B1%F0%9F%90%98TV/">爱🐘TV</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="../../../../tags/%E8%B6%85%E9%95%BF%E4%BB%A3%E7%A0%81%E9%A2%84%E8%AD%A6/">超长代码预警</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="../../../../tags/%E9%9D%9E%E4%BF%9D%E5%A7%86%E7%BA%A7%E6%95%99%E7%A8%8B/">非保姆级教程</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="../../../../tags/%E5%93%88%E5%9F%BA%E8%B1%A1%E6%AC%A0%E7%88%B1%E4%BA%86/">哈基象欠爱了</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="../../../../tags/%E9%95%BF%E6%AF%9B%E8%B1%A1%E5%89%8D%E7%AB%AF/">长毛象前端</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="../../../../tags/%E9%9D%9E%E5%9F%BA%E7%A1%80/">非基础</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="../../../../tags/%E9%95%BF%E6%AF%9B%E8%B1%A1%E8%AE%A1%E5%88%92%E5%8F%91%E5%98%9F/">长毛象计划发嘟</a></div></div></div><div class="main-content"><p>这个事情，我查了下我的git提交的日期，已经是半个月前自学的了，肯定不能保证包教包会，但是留了些代码和一些基础知识，可以给未来的我和有同样需求的象友们提供参考。</p>
<span id="more"></span>
<p>这篇心得我也不说面向什么基础的读者了，即使读者是大神，也可能会跟我导师听了我的presentation以后说出一样的话“我听不懂你在说什么”。只能说尽量提供帮助。</p>
<h1 id="需求背景"><a href="#需求背景" class="headerlink" title="需求背景"></a>需求背景</h1><p>有些网友很喜欢分享自己的生活。有的喜欢在网上当偶像，今天吃了草莓塔，<strong>马上</strong>发一个带美图的照片<del>然后就被坏人跟踪</del>。有的在基层默默无闻数年，诶，今天有幸领导带我去参加了一个涉密的会议，发个朋友圈炫耀一下。<del>这也得益于上头天天说教：“你没干坏事要什么隐私啊”结果现在国家安全教育难以下手，留下来的都是爱炫耀的人。</del><br>我在长毛象上最主要的痛点，就不是天天发家里的街景图和快递包装了，而是分享YouTube和b站视频。还有微信里面的一些文章。这种行为其实也有危险，<strong>即使把链接脱敏，</strong> 只要根据你发布的日期和时间，找到你大概在看视频时那段时间的那些评论，就能知道你的视频账号。随后可以根据你的投稿（如果有的话）和社工库里你账号绑定的身份证号，把你给开盒。<br>以上这种情况，只要晚两个小时再分享就可以多少减轻一点风险。<br>要做到这个，最没技术含量的办法，也是我最开始的办法，就是晚上再回去把视频翻出来，进行分享，同时要忍住不跟评论互动（不管是人家夸你，你去讨论也好，还是人家骂你，你去跟人讲道理也好）。代码上没技术含量，其实社会工程的技术含量也不小。我没上过培训班，不在乎老师说“你已经初中了，就不要用小学的知识来解题了”。我的处世之道是用的招数越傻越好，傻的满足不了需求了再用聪明的，用这样的方式让所有技术发挥最大作用。</p>
<h2 id="FediPlan"><a href="#FediPlan" class="headerlink" title="FediPlan"></a>FediPlan</h2><p>接下来我就去网上找有没有现成的办法推迟发嘟。我是不会为了锻炼而去找英文进行阅读的，不然我写出了这篇文章以后，还是会有人说我抄袭。搜“长毛象 计划发嘟”（菜鸟会搜“求救！！！长毛象怎么计划发嘟”），一般都是搜出怎么注册账号，甚至是怎么养大象之类的。然后用英文搜答案，就能找到了（别问我怎么练的英语，首先要学会照葫芦画瓢，不会ruby，不会javascript怎么办？找到类似的语法，把你想要的变量或词汇填进去！）。<br>我找到了这一篇 <a target="_blank" rel="noopener" href="https://fedi.tips/scheduling-posts-on-mastodon/">https://fedi.tips/scheduling-posts-on-mastodon/</a> 。你就能了解到，其实早就在开发了。已经有软件实现了计划发嘟。而官方，确实有一个API叫<code>scheduled_at</code>。我查了官方文档，确实如此。所以，现在所有计划发嘟的软件的原理，就是发嘟请求中带有<code>scheduled_at</code>，实例的服务器接收到了，就会安排定时发嘟。而官方web端和主流应用都没有这个功能。<br>到现在为止，你可以登录 <a target="_blank" rel="noopener" href="https://plan.fedilab.app/">https://plan.fedilab.app/</a> 这个网站进行发嘟。需要你跳转到你的实例以后，手动把token粘贴过来进行发嘟。该有的功能它都有，丑是有点丑，但是问题不大。缺点我认为就是发嘟文总会自带User Agent，而长毛象实例的服务器会根据你的UA给你的嘟文标注你用了哪个客户端。<br>如果这个FediPlan能改UA，那就无敌了，我也不需要写这个官方GitHub管理员都瞧不上的前端代码了。</p>
<h1 id="嘟文发送的基本原理"><a href="#嘟文发送的基本原理" class="headerlink" title="嘟文发送的基本原理"></a>嘟文发送的基本原理</h1><p>抛开客户端不谈，只简单讲讲网页端的原理，因为即使开发完了，官方和我的IceCube还是不能计划发嘟。<br>首先浏览器输入了实例的网址，登录了账号。这时会跳入这个路径 <a target="_blank" rel="noopener" href="https://cmx.dzm.pp.ua/deck/getting-started">https://cmx.dzm.pp.ua/deck/getting-started</a> （仅限登录成功时）。<br><img src="getting-started.png"><br>此时，浏览器会执行javascript代码。有基础的读者都知道，浏览器是javascript的解释器，只要安全策略允许，浏览器可以根据javascript代码做任何事。前端代码就在浏览器跑起来了。<br><img src="principle.jpeg"><br>长毛象的前端是用react写的。react的基础就不赘述了，不懂的懒得看，懂的都远远比我还懂。<br>只要注意，每一个组件都要首字母大写，然后在render函数内当作一个HTML元素使用。而这个组件，它的值不像HTML的表单一样可以让用户随意改。最基础的，是要编写函数<code>onChange</code>，然后通过<code>onChange</code>这个方法修改这个元素的值。每次<code>onChange</code>修改了元素的值，<code>render</code>函数都会重新运行一次。</p>
<h2 id="Redux的逻辑浅析"><a href="#Redux的逻辑浅析" class="headerlink" title="Redux的逻辑浅析"></a>Redux的逻辑浅析</h2><p>长毛象前端嘟文发送，并不像发送表单一样简单。你的嘟文，它的内容、媒体、投票、是否敏感、内容警告信息等一大串属性，最终都是要发给服务器的。而这些属性，都要反映在你的编辑界面里。所以这些<code>state</code>都储存在store里，每次有组件被操作，<code>onChange</code>就要触发<code>dispatch()</code>，而dispatch函数会根据括号里的参数找到<code>action</code>对象。action文件里定义了一大堆大写字母的变量，其实是为了防止调用<code>action.type</code>时遇到拼写错误无法正确执行期望的动作，且不报错的这个情况发生。随后action函数再去找reducer。因为每次发生更改，store里面的数组可能都要从头重新写一遍，所以为了简化代码，才有reducer这么个模块。reducer模块会枚举所有<code>action.type</code>，用大量<code>elseif</code>或<code>switch</code> <code>case</code>罗列所有<code>action.type</code>。<br><img src="redux.gif"><br>也就是说，你每点一次鼠标，每按一次键盘，上图的流程就要跑一圈。<br>直到最后，你编辑完毕，点下发送，它就会执行<code>submit</code>动作。这个动作直接调用了<code>api()</code>模块，把你的token，加上<code>store</code>里的所有<code>state</code>，发到服务器地址的指定路径下，最后经过nginx和puma的解析，让后端处理这些数据，将它们放入数据库，并发送给你的所有粉丝。</p>
<h1 id="代码魔改"><a href="#代码魔改" class="headerlink" title="代码魔改"></a>代码魔改</h1><p>以下是在前端添加计划发嘟功能的代码，请读者谨慎修改！</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">diff --git a/app/javascript/mastodon/actions/compose.js b/app/javascript/mastodon/actions/compose.js</span></span><br><span class="line"><span class="comment">index 7525be454..88cb684a8 100644</span></span><br><span class="line"><span class="comment">--- a/app/javascript/mastodon/actions/compose.js</span></span><br><span class="line"><span class="comment">+++ b/app/javascript/mastodon/actions/compose.js</span></span><br><span class="line"><span class="meta">@@ -81,6 +81,9 @@</span> export const COMPOSE_CHANGE_MEDIA_ORDER       = &#x27;COMPOSE_CHANGE_MEDIA_ORDER&#x27;;</span><br><span class="line"> export const COMPOSE_SET_STATUS = &#x27;COMPOSE_SET_STATUS&#x27;;</span><br><span class="line"> export const COMPOSE_FOCUS = &#x27;COMPOSE_FOCUS&#x27;;</span><br><span class="line"></span><br><span class="line"><span class="addition">+export const COMPOSE_CHANGE_IS_SCHEDULED = &#x27;COMPOSE_CHANGE_IS_SCHEDULED&#x27;;</span></span><br><span class="line"><span class="addition">+export const COMPOSE_CHANGE_SCHEDULE_TIME = &#x27;COMPOSE_CHANGE_SCHEDULE_TIME&#x27;;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"> const messages = defineMessages(&#123;</span><br><span class="line">   uploadErrorLimit: &#123; id: &#x27;upload_error.limit&#x27;, defaultMessage: &#x27;File upload limit exceeded.&#x27; &#125;,</span><br><span class="line">   open: &#123; id: &#x27;compose.published.open&#x27;, defaultMessage: &#x27;Open&#x27; &#125;,</span><br><span class="line"><span class="meta">@@ -187,6 +190,7 @@</span> export function submitCompose() &#123;</span><br><span class="line">     const status   = getState().getIn([&#x27;compose&#x27;, &#x27;text&#x27;], &#x27;&#x27;);</span><br><span class="line">     const media    = getState().getIn([&#x27;compose&#x27;, &#x27;media_attachments&#x27;]);</span><br><span class="line">     const statusId = getState().getIn([&#x27;compose&#x27;, &#x27;id&#x27;], null);</span><br><span class="line"><span class="addition">+    const is_scheduled = getState().getIn([&#x27;compose&#x27;, &#x27;is_scheduled&#x27;]);</span></span><br><span class="line"></span><br><span class="line">     if ((!status || !status.length) &amp;&amp; media.size <span class="comment">=== 0) &#123;</span></span><br><span class="line">       return;</span><br><span class="line"><span class="meta">@@ -227,6 +231,7 @@</span> export function submitCompose() &#123;</span><br><span class="line">         visibility: getState().getIn([&#x27;compose&#x27;, &#x27;privacy&#x27;]),</span><br><span class="line">         poll: getState().getIn([&#x27;compose&#x27;, &#x27;poll&#x27;], null),</span><br><span class="line">         language: getState().getIn([&#x27;compose&#x27;, &#x27;language&#x27;]),</span><br><span class="line"><span class="addition">+        scheduled_at: is_scheduled ? getState().getIn([&#x27;compose&#x27;, &#x27;scheduled_at&#x27;]) : null,</span></span><br><span class="line">       &#125;,</span><br><span class="line">       headers: &#123;</span><br><span class="line">         &#x27;Idempotency-Key&#x27;: getState().getIn([&#x27;compose&#x27;, &#x27;idempotencyKey&#x27;]),</span><br><span class="line"><span class="meta">@@ -236,9 +241,22 @@</span> export function submitCompose() &#123;</span><br><span class="line">         browserHistory.goBack();</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+      if (&#x27;scheduled_at&#x27; in response.data) &#123;</span></span><br><span class="line"><span class="addition">+        dispatch(showAlert(&#123;</span></span><br><span class="line"><span class="addition">+          message: messages.saved,</span></span><br><span class="line"><span class="addition">+          dismissAfter: 10000,</span></span><br><span class="line"><span class="addition">+        &#125;));</span></span><br><span class="line"><span class="addition">+        dispatch(submitComposeSuccess(&#123; ...response.data.params&#125;));</span></span><br><span class="line"><span class="addition">+        return;</span></span><br><span class="line"><span class="addition">+      &#125;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line">       dispatch(insertIntoTagHistory(response.data.tags, status));</span><br><span class="line">       dispatch(submitComposeSuccess(&#123; ...response.data &#125;));</span><br><span class="line"></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line">       // To make the app more responsive, immediately push the status</span><br><span class="line">       // into the columns</span><br><span class="line">       const insertIfOnline = timelineId =&gt; &#123;</span><br><span class="line"><span class="meta">@@ -829,3 +847,16 @@</span> export const changeMediaOrder = (a, b) =&gt; (&#123;</span><br><span class="line">   a,</span><br><span class="line">   b,</span><br><span class="line"> &#125;);</span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+export function changeIsScheduled() &#123;</span></span><br><span class="line"><span class="addition">+  return &#123;</span></span><br><span class="line"><span class="addition">+    type: COMPOSE_CHANGE_IS_SCHEDULED,</span></span><br><span class="line"><span class="addition">+  &#125;;</span></span><br><span class="line"><span class="addition">+&#125;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+export function changeScheduleTime(value) &#123;</span></span><br><span class="line"><span class="addition">+  return &#123;</span></span><br><span class="line"><span class="addition">+    type: COMPOSE_CHANGE_SCHEDULE_TIME,</span></span><br><span class="line"><span class="addition">+    value,</span></span><br><span class="line"><span class="addition">+  &#125;;</span></span><br><span class="line"><span class="addition">+&#125;</span></span><br><span class="line">\ No newline at end of file</span><br><span class="line"><span class="comment">diff --git a/app/javascript/mastodon/features/compose/components/compose_form.jsx b/app/javascript/mastodon/features/compose/components/compose_form.jsx</span></span><br><span class="line"><span class="comment">index b5e8dabb7..e1e0038eb 100644</span></span><br><span class="line"><span class="comment">--- a/app/javascript/mastodon/features/compose/components/compose_form.jsx</span></span><br><span class="line"><span class="comment">+++ b/app/javascript/mastodon/features/compose/components/compose_form.jsx</span></span><br><span class="line"><span class="meta">@@ -29,6 +29,9 @@</span> import &#123; PollForm &#125; from &quot;./poll_form&quot;;</span><br><span class="line"> import &#123; ReplyIndicator &#125; from &#x27;./reply_indicator&#x27;;</span><br><span class="line"> import &#123; UploadForm &#125; from &#x27;./upload_form&#x27;;</span><br><span class="line"></span><br><span class="line"><span class="addition">+import ScheduleButtonContainer from &#x27;../containers/schedule_button_container&#x27;;</span></span><br><span class="line"><span class="addition">+import &#123; ScheduleForm &#125; from &#x27;./schedule_form&#x27;;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"> const allowedAroundShortCode = &#x27;&gt;&lt;\u0085\u0020\u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\u0009\u000a\u000b\u000c\u000d&#x27;;</span><br><span class="line"></span><br><span class="line"> const messages = defineMessages(&#123;</span><br><span class="line"><span class="meta">@@ -69,6 +72,11 @@</span> class ComposeForm extends ImmutablePureComponent &#123;</span><br><span class="line">     singleColumn: PropTypes.bool,</span><br><span class="line">     lang: PropTypes.string,</span><br><span class="line">     maxChars: PropTypes.number,</span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+    schedule_time: PropTypes.string,</span></span><br><span class="line"><span class="addition">+    schedule_timezone: PropTypes.string,</span></span><br><span class="line"><span class="addition">+    is_scheduled: PropTypes.bool.isRequired,</span></span><br><span class="line"><span class="addition">+    scheduled_at: PropTypes.string,</span></span><br><span class="line">   &#125;;</span><br><span class="line"></span><br><span class="line">   static defaultProps = &#123;</span><br><span class="line"><span class="meta">@@ -295,6 +303,7 @@</span> class ComposeForm extends ImmutablePureComponent &#123;</span><br><span class="line">                 &lt;PollButtonContainer /&gt;</span><br><span class="line">                 &lt;SpoilerButtonContainer /&gt;</span><br><span class="line">                 &lt;EmojiPickerDropdown onPickEmoji=&#123;this.handleEmojiPick&#125; /&gt;</span><br><span class="line"><span class="addition">+                &lt;ScheduleButtonContainer /&gt;</span></span><br><span class="line">                 &lt;CharacterCounter max=&#123;maxChars&#125; text=&#123;this.getFulltextForCharacterCounting()&#125; /&gt;</span><br><span class="line">               &lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">@@ -306,6 +315,7 @@</span> class ComposeForm extends ImmutablePureComponent &#123;</span><br><span class="line">                 /&gt;</span><br><span class="line">               &lt;/div&gt;</span><br><span class="line">             &lt;/div&gt;</span><br><span class="line"><span class="addition">+            &lt;ScheduleForm /&gt;</span></span><br><span class="line">           &lt;/div&gt;</span><br><span class="line">         &lt;/div&gt;</span><br><span class="line">       &lt;/form&gt;</span><br><span class="line"><span class="comment">diff --git a/app/javascript/mastodon/features/compose/components/schedule_form.jsx b/app/javascript/mastodon/features/compose/components/schedule_form.jsx</span></span><br><span class="line">new file mode 100644</span><br><span class="line"><span class="comment">index 000000000..435d9427d</span></span><br><span class="line"><span class="comment">--- /dev/null</span></span><br><span class="line"><span class="comment">+++ b/app/javascript/mastodon/features/compose/components/schedule_form.jsx</span></span><br><span class="line"><span class="meta">@@ -0,0 +1,41 @@</span></span><br><span class="line"><span class="addition">+import PropTypes from &#x27;prop-types&#x27;;</span></span><br><span class="line"><span class="addition">+import &#123; useCallback &#125; from &#x27;react&#x27;;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+import &#123; defineMessages, useIntl &#125; from &#x27;react-intl&#x27;;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+import classNames from &#x27;classnames&#x27;;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+import &#123; useDispatch, useSelector&#125; from &#x27;react-redux&#x27;;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+import &#123; changeScheduleTime &#125; from &#x27;mastodon/actions/compose&#x27;;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+const messages = defineMessages(&#123;</span></span><br><span class="line"><span class="addition">+    schedule_time: &#123; id: &#x27;compose_form.schedule_time&#x27;, defaultMessage: &#x27;计划发文时间（北京时间）&#x27; &#125;,</span></span><br><span class="line"><span class="addition">+&#125;);</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+export const ScheduleForm = () =&gt; &#123;</span></span><br><span class="line"><span class="addition">+    const is_scheduled = useSelector(state =&gt; state.getIn([&#x27;compose&#x27;, &#x27;is_scheduled&#x27;]));</span></span><br><span class="line"><span class="addition">+    const schedule_time = useSelector(state =&gt; state.getIn([&#x27;compose&#x27;, &#x27;schedule_time&#x27;]));</span></span><br><span class="line"><span class="addition">+    const dispatch = useDispatch();</span></span><br><span class="line"><span class="addition">+    const intl = useIntl();</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+    const handleChange = useCallback((&#123; target: &#123; value &#125; &#125;) =&gt; &#123;</span></span><br><span class="line"><span class="addition">+        dispatch(changeScheduleTime(value));</span></span><br><span class="line"><span class="addition">+    &#125;, [dispatch]);</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+    if (!is_scheduled) &#123;</span></span><br><span class="line"><span class="addition">+        return null;</span></span><br><span class="line"><span class="addition">+    &#125;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+    return (</span></span><br><span class="line"><span class="addition">+        &lt;div&gt;</span></span><br><span class="line"><span class="addition">+            &lt;label&gt;&#123;intl.formatMessage(messages.schedule_time)&#125;&lt;/label&gt;</span></span><br><span class="line"><span class="addition">+            &lt;input</span></span><br><span class="line"><span class="addition">+                className=&#x27;search__input&#x27;</span></span><br><span class="line"><span class="addition">+                type=&#x27;datetime-local&#x27;</span></span><br><span class="line"><span class="addition">+                value=&#123;schedule_time&#125;</span></span><br><span class="line"><span class="addition">+                onChange=&#123;handleChange&#125;</span></span><br><span class="line"><span class="addition">+            /&gt;</span></span><br><span class="line"><span class="addition">+        &lt;/div&gt;</span></span><br><span class="line"><span class="addition">+    );</span></span><br><span class="line"><span class="addition">+&#125;</span></span><br><span class="line">\ No newline at end of file</span><br><span class="line"><span class="comment">diff --git a/app/javascript/mastodon/features/compose/containers/compose_form_container.js b/app/javascript/mastodon/features/compose/containers/compose_form_container.js</span></span><br><span class="line"><span class="comment">index 76ac65bf3..e97d33695 100644</span></span><br><span class="line"><span class="comment">--- a/app/javascript/mastodon/features/compose/containers/compose_form_container.js</span></span><br><span class="line"><span class="comment">+++ b/app/javascript/mastodon/features/compose/containers/compose_form_container.js</span></span><br><span class="line"><span class="meta">@@ -29,6 +29,10 @@</span> const mapStateToProps = state =&gt; (&#123;</span><br><span class="line">   isInReply: state.getIn([&#x27;compose&#x27;, &#x27;in_reply_to&#x27;]) !== null,</span><br><span class="line">   lang: state.getIn([&#x27;compose&#x27;, &#x27;language&#x27;]),</span><br><span class="line">   maxChars: state.getIn([&#x27;server&#x27;, &#x27;server&#x27;, &#x27;configuration&#x27;, &#x27;statuses&#x27;, &#x27;max_characters&#x27;], 5000),</span><br><span class="line"><span class="addition">+  is_scheduled: state.getIn([&#x27;compose&#x27;, &#x27;is_scheduled&#x27;]),</span></span><br><span class="line"><span class="addition">+  schedule_time: state.getIn([&#x27;compose&#x27;, &#x27;schedule_time&#x27;]),</span></span><br><span class="line"><span class="addition">+  schedule_timezone: state.getIn([&#x27;compose&#x27;, &#x27;schedule_timezone&#x27;]),</span></span><br><span class="line"><span class="addition">+  scheduled_at: state.getIn([&#x27;compose&#x27;, &#x27;scheduled_at&#x27;]),</span></span><br><span class="line"> &#125;);</span><br><span class="line"></span><br><span class="line"> const mapDispatchToProps = (dispatch) =&gt; (&#123;</span><br><span class="line"><span class="comment">diff --git a/app/javascript/mastodon/features/compose/containers/schedule_button_container.js b/app/javascript/mastodon/features/compose/containers/schedule_button_container.js</span></span><br><span class="line">new file mode 100644</span><br><span class="line"><span class="comment">index 000000000..0ece8ffb8</span></span><br><span class="line"><span class="comment">--- /dev/null</span></span><br><span class="line"><span class="comment">+++ b/app/javascript/mastodon/features/compose/containers/schedule_button_container.js</span></span><br><span class="line"><span class="meta">@@ -0,0 +1,30 @@</span></span><br><span class="line"><span class="addition">+import &#123; injectIntl, defineMessages &#125; from &quot;react-intl&quot;;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+import &#123; connect &#125; from &#x27;react-redux&#x27;;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+import ScheduleIcon from &#x27;@/material-icons/400-20px/schedule.svg?react&#x27;;</span></span><br><span class="line"><span class="addition">+import &#123; IconButton &#125; from &quot;@/mastodon/components/icon_button&quot;;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+import &#123; changeIsScheduled &#125; from &#x27;../../../actions/compose&#x27;;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+const messages = defineMessages(&#123;</span></span><br><span class="line"><span class="addition">+    marked: &#123; id: &#x27;compose_form.schedule.marked&#x27;, defaultMessage: &#x27;本文将在以下时间发布&#x27;&#125;,</span></span><br><span class="line"><span class="addition">+    unmarked: &#123; id: &#x27;compose_form.schedule.unmarked&#x27;, defaultMessage: &#x27;文本将立即发布&#x27;&#125;,</span></span><br><span class="line"><span class="addition">+&#125;)</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+const mapStateToProps = (state, &#123; intl &#125;) =&gt; (&#123;</span></span><br><span class="line"><span class="addition">+    iconComponent: ScheduleIcon,</span></span><br><span class="line"><span class="addition">+    title: intl.formatMessage(state.getIn([&#x27;compose&#x27;, &#x27;is_scheduled&#x27;]) ? messages.marked : messages.unmarked),</span></span><br><span class="line"><span class="addition">+    active: state.getIn([&#x27;compose&#x27;, &#x27;is_scheduled&#x27;]),</span></span><br><span class="line"><span class="addition">+    ariaControls: &#x27;schedule-publish&#x27;,</span></span><br><span class="line"><span class="addition">+    size: 18,</span></span><br><span class="line"><span class="addition">+    inverted: true,</span></span><br><span class="line"><span class="addition">+&#125;);</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+const mapDispatchToProps = dispatch =&gt; (&#123;</span></span><br><span class="line"><span class="addition">+    onClick () &#123;</span></span><br><span class="line"><span class="addition">+        dispatch(changeIsScheduled());</span></span><br><span class="line"><span class="addition">+    &#125;,</span></span><br><span class="line"><span class="addition">+&#125;);</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+export default injectIntl(connect(mapStateToProps, mapDispatchToProps)(IconButton));</span></span><br><span class="line">\ No newline at end of file</span><br><span class="line"><span class="comment">diff --git a/app/javascript/mastodon/reducers/compose.js b/app/javascript/mastodon/reducers/compose.js</span></span><br><span class="line"><span class="comment">index bfa2ec6a0..6b9a2c3ec 100644</span></span><br><span class="line"><span class="comment">--- a/app/javascript/mastodon/reducers/compose.js</span></span><br><span class="line"><span class="comment">+++ b/app/javascript/mastodon/reducers/compose.js</span></span><br><span class="line"><span class="meta">@@ -50,6 +50,8 @@</span> import &#123;</span><br><span class="line">   COMPOSE_CHANGE_MEDIA_ORDER,</span><br><span class="line">   COMPOSE_SET_STATUS,</span><br><span class="line">   COMPOSE_FOCUS,</span><br><span class="line"><span class="addition">+  COMPOSE_CHANGE_IS_SCHEDULED,</span></span><br><span class="line"><span class="addition">+  COMPOSE_CHANGE_SCHEDULE_TIME</span></span><br><span class="line"> &#125; from &#x27;../actions/compose&#x27;;</span><br><span class="line"> import &#123; REDRAFT &#125; from &#x27;../actions/statuses&#x27;;</span><br><span class="line"> import &#123; STORE_HYDRATE &#125; from &#x27;../actions/store&#x27;;</span><br><span class="line"><span class="meta">@@ -94,6 +96,11 @@</span> const initialState = ImmutableMap(&#123;</span><br><span class="line">     focusY: 0,</span><br><span class="line">     dirty: false,</span><br><span class="line">   &#125;),</span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+  schedule_time: null,</span></span><br><span class="line"><span class="addition">+  schedule_timezone: &#x27;+08:00&#x27;,</span></span><br><span class="line"><span class="addition">+  is_scheduled: false,</span></span><br><span class="line"><span class="addition">+  scheduled_at: null,</span></span><br><span class="line"> &#125;);</span><br><span class="line"></span><br><span class="line"> const initialPoll = ImmutableMap(&#123;</span><br><span class="line"><span class="meta">@@ -127,6 +134,9 @@</span> function clearAll(state) &#123;</span><br><span class="line">     map.update(&#x27;media_attachments&#x27;, list =&gt; list.clear());</span><br><span class="line">     map.set(&#x27;poll&#x27;, null);</span><br><span class="line">     map.set(&#x27;idempotencyKey&#x27;, uuid());</span><br><span class="line"><span class="addition">+    map.set(&#x27;schedule_time&#x27;, null);</span></span><br><span class="line"><span class="addition">+    map.set(&#x27;is_scheduled&#x27;, false);</span></span><br><span class="line"><span class="addition">+    map.set(&#x27;scheduled_at&#x27;, null);</span></span><br><span class="line">   &#125;);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@@ -560,6 +570,18 @@</span> export default function compose(state = initialState, action) &#123;</span><br><span class="line"></span><br><span class="line">       return list.splice(indexA, 1).splice(indexB, 0, moveItem);</span><br><span class="line">     &#125;);</span><br><span class="line"><span class="addition">+  case COMPOSE_CHANGE_IS_SCHEDULED:</span></span><br><span class="line"><span class="addition">+    return state.withMutations(map =&gt; &#123;</span></span><br><span class="line"><span class="addition">+      map.set(&#x27;is_scheduled&#x27;, !state.get(&#x27;is_scheduled&#x27;));</span></span><br><span class="line"><span class="addition">+      map.set(&#x27;scheduled_at&#x27;, state.get(&#x27;schedule_time&#x27;) + &#x27;:00.0&#x27; + state.get(&#x27;schedule_timezone&#x27;));</span></span><br><span class="line"><span class="addition">+      map.set(&#x27;idempotencyKey&#x27;, uuid());</span></span><br><span class="line"><span class="addition">+    &#125;);</span></span><br><span class="line"><span class="addition">+  case COMPOSE_CHANGE_SCHEDULE_TIME:</span></span><br><span class="line"><span class="addition">+    return state.withMutations(map =&gt; &#123;</span></span><br><span class="line"><span class="addition">+      map.set(&#x27;schedule_time&#x27;, action.value);</span></span><br><span class="line"><span class="addition">+      map.set(&#x27;scheduled_at&#x27;, action.value + &#x27;:00.0&#x27; + state.get(&#x27;schedule_timezone&#x27;));</span></span><br><span class="line"><span class="addition">+      map.set(&#x27;idempotencyKey&#x27;, uuid());</span></span><br><span class="line"><span class="addition">+    &#125;);</span></span><br><span class="line">   default:</span><br><span class="line">     return state;</span><br><span class="line">   &#125;</span><br><span class="line"><span class="comment">diff --git a/app/javascript/material-icons/400-20px/schedule.svg b/app/javascript/material-icons/400-20px/schedule.svg</span></span><br><span class="line">new file mode 100644</span><br><span class="line"><span class="comment">index 000000000..350607c71</span></span><br><span class="line"><span class="comment">--- /dev/null</span></span><br><span class="line"><span class="comment">+++ b/app/javascript/material-icons/400-20px/schedule.svg</span></span><br><span class="line"><span class="meta">@@ -0,0 +1,6 @@</span></span><br><span class="line"><span class="addition">+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="addition">+&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; width=&quot;20px&quot; height=&quot;20px&quot; viewBox=&quot;0 0 20 20&quot; version=&quot;1.1&quot;&gt;</span></span><br><span class="line"><span class="addition">+&lt;g id=&quot;surface1&quot;&gt;</span></span><br><span class="line"><span class="addition">+&lt;path style=&quot; stroke:none;fill-rule:nonzero;fill-opacity:1;&quot; d=&quot;M 13.476562 8.167969 C 15.507812 8.167969 17.382812 9.214844 18.398438 10.917969 C 19.417969 12.609375 19.417969 14.722656 18.398438 16.417969 C 17.382812 18.117188 15.507812 19.167969 13.476562 19.167969 C 10.332031 19.167969 7.785156 16.699219 7.785156 13.667969 C 7.785156 10.632812 10.332031 8.167969 13.476562 8.167969 Z M 7.160156 1.25 L 7.160156 2.058594 L 12.214844 2.058594 L 12.214844 1.25 C 12.214844 1.023438 12.398438 0.832031 12.632812 0.832031 L 13.066406 0.832031 C 13.292969 0.832031 13.484375 1.015625 13.484375 1.25 L 13.484375 2.058594 L 18.125 2.058594 C 18.359375 2.058594 18.542969 2.25 18.542969 2.476562 L 18.542969 8.367188 C 18.542969 8.589844 18.359375 8.785156 18.125 8.785156 L 17.691406 8.785156 C 17.457031 8.785156 17.273438 8.601562 17.273438 8.367188 L 17.273438 6.949219 L 2.101562 6.949219 L 2.101562 17.332031 L 7.375 17.332031 C 7.609375 17.332031 7.792969 17.515625 7.792969 17.75 L 7.792969 18.140625 C 7.792969 18.375 7.609375 18.558594 7.375 18.558594 L 0.832031 18.558594 L 0.832031 2.476562 C 0.832031 2.242188 1.015625 2.058594 1.25 2.058594 L 5.890625 2.058594 L 5.890625 1.25 C 5.890625 1.023438 6.074219 0.832031 6.308594 0.832031 L 6.742188 0.832031 C 6.964844 0.832031 7.160156 1.015625 7.160156 1.25 Z M 13.476562 9.390625 C 11.890625 9.390625 10.433594 10.207031 9.640625 11.535156 C 8.851562 12.859375 8.851562 14.492188 9.640625 15.808594 C 10.433594 17.125 11.890625 17.949219 13.476562 17.949219 C 15.917969 17.949219 17.898438 16.035156 17.898438 13.675781 C 17.898438 11.316406 15.917969 9.390625 13.476562 9.390625 Z M 12.523438 11.226562 L 13.375 11.226562 C 13.609375 11.226562 13.792969 11.410156 13.792969 11.640625 L 13.792969 13.941406 C 13.792969 14.089844 13.875 14.234375 14.007812 14.308594 L 14.976562 14.851562 C 15.074219 14.902344 15.144531 14.996094 15.175781 15.105469 C 15.207031 15.210938 15.191406 15.328125 15.132812 15.425781 L 14.726562 16.117188 L 12.75 15.015625 C 12.617188 14.941406 12.535156 14.800781 12.535156 14.648438 L 12.535156 11.226562 Z M 5.890625 3.273438 L 2.101562 3.273438 L 2.101562 5.714844 L 17.273438 5.714844 L 17.273438 3.273438 L 13.484375 3.273438 L 13.484375 4.082031 C 13.484375 4.316406 13.300781 4.5 13.066406 4.5 L 12.632812 4.5 C 12.398438 4.5 12.214844 4.316406 12.214844 4.082031 L 12.214844 3.273438 L 7.160156 3.273438 L 7.160156 4.082031 C 7.160156 4.316406 6.976562 4.5 6.742188 4.5 L 6.308594 4.5 C 6.074219 4.5 5.890625 4.316406 5.890625 4.082031 Z M 5.890625 3.273438 &quot;/&gt;</span></span><br><span class="line"><span class="addition">+&lt;/g&gt;</span></span><br><span class="line"><span class="addition">+&lt;/svg&gt;</span></span><br><span class="line">(END)</span><br></pre></td></tr></table></figure>

<h1 id="长毛象主题的修改"><a href="#长毛象主题的修改" class="headerlink" title="长毛象主题的修改"></a>长毛象主题的修改</h1><p>代码因主题而异，由于笔者未介绍过如何安装主题，所以只简略地说一下：<br>首先在测试环境的网页端或已经上线的网页端，按F12查看元素，大概在右下角可以修改样式。调整某些数值，直到错位解决以后，再在样式的.scss文件搜索这个元素的<code>class</code>名称，对其中的数据进行修改。<br>总之，这个过程比魔改计划发文更容易依样画葫芦。</p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>这个代码并非完成版。仔细看了就会发现，时区仅限东八区。这是因为我还没设计出选择时区的界面，也不知道该如何实现。下次有时间一定补上。</p>
</div><div class="post-copyright valine" id="comments-container"><script src="//unpkg.com/valine@1.4.14/dist/Valine.min.js"></script><script>let arr = location.href.split('/#more')[0].split('/');
let title = arr[arr.length - 1];
if (title === '') {
    title = arr[arr.length - 2];
}
var flag = false;
var gitFun = function () {
    try {
        var valineObj = window.GLOBAL_CONFIG.valine;
        new Valine({
            el: "#comments-container",
            ...valineObj
        });
        flag = true;
    } catch (e) {
        flag = false;
    }
}
var setIn = setInterval(() => {
    if (!flag) {
        gitFun();
    } else {
        clearInterval(setIn);
    }
}, 200);</script></div></article><div id="pagination"><div class="prev-post pull-left"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="../../18/mastodon-b2-cdn/"><i class="fas fa-angle-left">&nbsp;</i><span>长毛象配置b2对象存储不完全教程</span></a></div><div class="next-post pull-right"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="../../../04/12/migrating-instance/"><span>长毛象实例迁移</span><span>&nbsp;</span><i class="fas fa-angle-right"></i></a></div></div><!--div!= paginator()--></div></div><div class="button-hover" id="return-top"><i class="fas fa-arrow-up" aria-hidden="true"></i></div><footer><div id="footer"><div class="button-hover" id="side-button"><i class="fas fa-arrow-right"></i></div><div class="right-content"><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fas fa-file-o"></i></span><span id="busuanzi_value_page_pv"></span><span></span></div><div class="copyright">&copy;2025 By 妙瓦草</div></div></div></footer></div><!--js(src=url_for(url) + '?version=' + version())--><script src="../../../../js/thirdparty/jquery-3.3.1.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="../../../../js/thirdparty/velocity.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="../../../../js/thirdparty/jquery.mCustomScrollbar.concat.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="../../../../js/fan.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="../../../../js/canvas_bg.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="../../../../js/utils.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="../../../../js/scroll.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="../../../../js/sidebar.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="../../../../js/copy.js"></script><!--script(src=url)--><div class="search-dialog"><div id="algolia-search-title">Algolia</div><div class="search-close-button"><i class="fa fa-times"></i></div><!--div#current-refined-values--><!--div#clear-all--><div id="search-box"></div><!--div#refinement-list--><hr><div id="hits"></div><div id="algolia-pagination"></div></div><div class="search-mask"></div><script src="../../../../js/search/algolia.js"></script></body></html>