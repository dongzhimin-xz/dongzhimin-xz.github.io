<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="长毛象引用功能"><meta name="keywords" content="什么都阻挡不了我的键政,长毛象引用功能,长毛象v4.5.0以上版本"><meta name="author" content="妙瓦草,undefined"><meta name="copyright" content="妙瓦草"><title>长毛象引用功能【妙瓦种子】</title><link rel="stylesheet" href="../../../../css/fan.css"><link rel="stylesheet" href="../../../../css/thirdparty/jquery.mCustomScrollbar.min.css"><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"><link rel="icon" href="../../../../favicon.ico"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch-theme-algolia.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4"></script><!-- link(rel="dns-prefetch" href="https://cdn.jsdelivr.net")--><!-- link(rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css")--><!-- script(src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer)--><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- script(src=url_for("/js/mathjax/mathjax.js"))--><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
});
</script><script>var isPassword = '' || false;
if (isPassword) {
    if (prompt('请输入文章密码') !== '') {
        alert('密码错误！');
        history.back();
    }
}</script><script>window.GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"BLFJMI3OZT","apiKey":"bfca30d788c8947af1865ed33655b646","indexName":"blog","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  gitment: {},
  valine: {"appId":"xASAWVJMlgR6Z0IAumJosLmQ-MdYXbMMI","appKey":"hrSzqoj09CVByDzUeBMDEjuF","serverURLs":"https://xasawvjm.api.lncldglobal.com"},
  twikoo: {},
}</script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="atom.xml" title="妙瓦种子" type="application/atom+xml">
</head><body><canvas id="universe"></canvas><!--#body--><div id="sidebar"><div class="toggle-sidebar-info button-hover"><span data-toggle="文章目录">站点概览</span></div><div class="sidebar-toc"><div class="sidebar-toc-title">目录</div><div class="sidebar-toc-progress"><span class="progress-notice">您已阅读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc-progress-bar"></div></div><div class="sidebar-toc-content" id="sidebar-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF"><span class="toc-number">1.</span> <span class="toc-text">需求背景</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E7%AB%99%E4%B8%8A%E7%BA%BF%E6%96%B0%E5%8A%9F%E8%83%BD"><span class="toc-number">1.1.</span> <span class="toc-text">主站上线新功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%95%BF%E6%AF%9B%E8%B1%A1%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E6%96%B0%E5%8A%9F%E8%83%BD"><span class="toc-number">1.2.</span> <span class="toc-text">长毛象客户端的新功能</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%AD%94%E6%94%B9%E8%BF%87%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text">魔改过程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%95%E9%AA%8C%E7%94%B0%E7%9A%84%E9%AD%94%E6%94%B9"><span class="toc-number">2.1.</span> <span class="toc-text">试验田的魔改</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%88%E5%B9%B6%E5%85%A5%E4%B8%BB%E5%88%86%E6%94%AF"><span class="toc-number">2.2.</span> <span class="toc-text">合并入主分支</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%95%BF%E6%AF%9B%E8%B1%A1v4-5-x%E7%9A%84%E5%BC%95%E7%94%A8%E5%8A%9F%E8%83%BD%E4%BB%A3%E7%A0%81%E5%92%8C%E5%88%86%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text">长毛象v4.5.x的引用功能代码和分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E7%BD%91%E9%A1%B5%E7%AB%AF%E5%BC%95%E7%94%A8%E6%8C%89%E9%92%AE%E8%A2%AB%E7%A6%81%E6%83%85%E5%86%B5"><span class="toc-number">3.1.</span> <span class="toc-text">解决网页端引用按钮被禁情况</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%97%A0%E6%B3%95%E5%8F%91%E9%80%81%E8%BD%AC%E8%AF%84%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-number">3.2.</span> <span class="toc-text">解决无法发送转评的情况</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E5%8F%91%E9%80%81%E8%BD%AC%E8%AF%84%E6%97%B6%EF%BC%8C%E9%81%AD%E5%88%B0%E5%90%8E%E7%AB%AF%E6%8B%92%E7%BB%9D%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-number">3.3.</span> <span class="toc-text">解决发送转评时，遭到后端拒绝的情况</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E8%BD%AC%E8%AF%84%E5%8F%91%E9%80%81%E5%90%8E%EF%BC%8C%E6%98%BE%E7%A4%BA%E2%80%9C%E5%98%9F%E6%96%87%E5%BE%85%E5%8F%91%E5%B8%83%E2%80%9D%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-number">3.4.</span> <span class="toc-text">解决转评发送后，显示“嘟文待发布”的情况</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%96%E7%AB%99%E6%8A%98%E4%B8%AD%E6%96%B9%E6%A1%88"><span class="toc-number">3.5.</span> <span class="toc-text">外站折中方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E4%B8%8A%E4%B8%80%E8%8A%82%E6%97%A0%E6%B3%95%E7%94%9F%E6%95%88%E7%9A%84bug"><span class="toc-number">3.6.</span> <span class="toc-text">解决上一节无法生效的bug</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E9%83%A8%E5%88%86%E5%A4%96%E7%AB%99%E5%AE%9E%E4%BE%8B%E5%AF%BC%E8%87%B4%E7%9A%84%E2%80%9C%E5%98%9F%E6%96%87%E5%B7%B2%E5%88%A0%E9%99%A4%E2%80%9D%E9%97%AE%E9%A2%98"><span class="toc-number">3.7.</span> <span class="toc-text">解决部分外站实例导致的“嘟文已删除”问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E9%95%BF%E6%AF%9B%E8%B1%A1%EF%BC%88%E6%89%8B%E6%9C%BA%EF%BC%89%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%97%A0%E6%B3%95%E5%BC%95%E7%94%A8%E5%A4%A7%E9%83%A8%E5%88%86%E5%98%9F%E6%96%87%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">3.8.</span> <span class="toc-text">解决长毛象（手机）客户端无法引用大部分嘟文的问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%8E%E8%AE%B0"><span class="toc-number">4.</span> <span class="toc-text">后记</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info-avatar"><img class="author-info-avatar-img" src="/avatar.png"></div><div class="author-info-name">妙瓦草</div><div class="author-info-description"></div><div class="links-buttons"><a class="links-button button-hover" href="https://github.com/fan-lv" target="_blank">GitHub<i class="icon-dot bg-color8"></i></a><a class="links-button button-hover" href="mailto:15757856604@163.com" target="_blank">E-Mail<i class="icon-dot bg-color4"></i></a><a class="links-button button-hover" href="tencent://message/?uin=1019593584&amp;Site=&amp;Menu=yes" target="_blank">QQ<i class="icon-dot bg-color6"></i></a></div><div class="author-info-articles"><a class="author-info-articles-archives article-meta" href="../../../../archives"><span class="pull-top">日志</span><span class="pull-bottom">22</span></a><a class="author-info-articles-tags article-meta" href="../../../../tags"><span class="pull-top">标签</span><span class="pull-bottom">46</span></a><a class="author-info-articles-categories article-meta" href="../../../../categories"><span class="pull-top">分类</span><span class="pull-bottom">30</span></a></div></div></div><div id="main-container"><header><div id="menu-outer"><i class="menu-list-icon fas fa-bars"></i><nav id="menu-inner"><a class="menu-item" href="/">首页</a><a class="menu-item" href="/tags">标签</a><a class="menu-item" href="/categories">分类</a><a class="menu-item" href="/archives">归档</a><a class="menu-item" href="/about">关于</a></nav><div class="right-info"><a class="search social-icon"><i class="fas fa-search"></i><span> 搜索</span></a><a class="title-name" href="/">妙瓦种子</a><span id="now-time"></span></div></div></header><div id="content-outer"><div id="content-inner"><article id="post"><div class="post-header"><div class="title">长毛象引用功能</div><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 发表于 2025-11-23 | 更新于 2025-11-23</time><!--time.button-hover.post-date #[i.fas.fa-calendar-alt.article-icon(aria-hidden="true")] #[=__('post.modified')] #[=date(page['updated'], config.date_format)]--><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="../../../../categories/%E5%BB%BA%E7%AB%99%E6%8A%80%E6%9C%AF/">建站技术</a><i class="fa fa-angle-right" style="margin: 0 8px;"></i><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="../../../../categories/%E5%BB%BA%E7%AB%99%E6%8A%80%E6%9C%AF/%E9%95%BF%E6%AF%9B%E8%B1%A1%E4%B8%AD%E5%BA%A6%E9%AD%94%E6%94%B9/">长毛象中度魔改</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="../../../../tags/%E4%BB%80%E4%B9%88%E9%83%BD%E9%98%BB%E6%8C%A1%E4%B8%8D%E4%BA%86%E6%88%91%E7%9A%84%E9%94%AE%E6%94%BF/">什么都阻挡不了我的键政</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="../../../../tags/%E9%95%BF%E6%AF%9B%E8%B1%A1%E5%BC%95%E7%94%A8%E5%8A%9F%E8%83%BD/">长毛象引用功能</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="../../../../tags/%E9%95%BF%E6%AF%9B%E8%B1%A1v4-5-0%E4%BB%A5%E4%B8%8A%E7%89%88%E6%9C%AC/">长毛象v4.5.0以上版本</a></div></div></div><div class="main-content"><p>长毛象的引用功能，在小森林和各种魔改都已经实现，虽然只有本站才能看见引用效果。<br>非官方客户端，例如IceCube也可以引用嘟文，本质上还是复制转发对象的链接罢了。<br>其实，我觉得这也可以了，毕竟本来长毛象官方就不让带评论转发，“以防对用户进行网暴”。</p>
<span id="more"></span>
<h1 id="需求背景"><a href="#需求背景" class="headerlink" title="需求背景"></a>需求背景</h1><p>但是，这还是令人有些不爽，能一个键解决的事，为什么还要多复制粘贴一下呢？而且这个纯手工引用的效果，让人一眼看不出我在评<del>挂</del>什么东西。恰好我的引用需求又很多，因为我关注的都是搬运推友的机器人🥺。<br>引用这个功能，我还是要加的。毕竟我想“网暴”谁，我直接天天截图，用爬虫拉他的推文就是了。你想用引用功能来限制别人裱人，就跟用宪法里国家主席的十年任期来限制总书记不能连任终身一样🤭所以我认为引用就必须毫无限制地加上！</p>
<p>然后我就参考了<a target="_blank" rel="noopener" href="https://hello.2heng.xin/">小森林</a>的代码，<a target="_blank" rel="noopener" href="https://github.com/mashirozx/mastodon/tree/5569238d5ed0011b50157dcedd124e7f2eed0100">这在他们首页有公布</a>。我研究了一下代码以后发现，要实现引用功能，需要给数据库加一列，这个魔改就很超过了。当时长毛象稳定版还在v4.4.x，已经可以显示外站引用了，但是我们却不能引用别人。<br>宁与友邦，不与家奴了属于是<br><img src="beat-foreigners.png" alt="打不了洋人，还打不了你么"><br>我给长毛象的GitHub仓库提了issue，要求加一个引用功能，他们回复“在做了”，预计在v4.5.0问世。其实我看见有<code>feature-flag</code>了，只是不知道怎么去除。而且我只是魔改，没打算硬分叉，所以先让官方飞一会儿，下次升级直接跳到<code>main</code>分支。</p>
<h2 id="主站上线新功能"><a href="#主站上线新功能" class="headerlink" title="主站上线新功能"></a>主站上线新功能</h2><p>后来，<a target="_blank" rel="noopener" href="https://mastodon.social/">官方主站</a>解禁了引用功能，我用我的小号偷偷地看了一下，发现这不是坑爹么？所有升级前的嘟文，外站（旧版本长毛象和其他Fedi软件）所有的嘟文均“无权引用”！只有本站升级后，用户发帖，且选择你可以引用，你才能使用引用功能。</p>
<h2 id="长毛象客户端的新功能"><a href="#长毛象客户端的新功能" class="headerlink" title="长毛象客户端的新功能"></a>长毛象客户端的新功能</h2><p>不仅限制网页端，本来IceCube可以引用的，升级实例以后，该账号也会显示“无权引用”。这不是沪C是什么啊？😅</p>
<blockquote>
<p>沪C的梗也算全国闻名了，上海市外环线内，外地牌照可以进，但是上海的沪C不能进<br><img src="huC1.webp"><br><img src="huC2.webp"></p>
</blockquote>
<p>长毛象这样也不算坏事，毕竟只需要轻微魔改一下就可以引用了嘛。以后的刷嘟体验肯定会显著提升的。</p>
<h1 id="魔改过程"><a href="#魔改过程" class="headerlink" title="魔改过程"></a>魔改过程</h1><p>要实行起来比较复杂，毕竟从<code>stable-4.4</code>变基或合并到主分支可不是开玩笑的。</p>
<h2 id="试验田的魔改"><a href="#试验田的魔改" class="headerlink" title="试验田的魔改"></a>试验田的魔改</h2><p>之前因为<a href="/2025/08/31/%E5%85%B3%E4%BA%8E%E6%9C%80%E8%BF%91%E5%81%9C%E6%9B%B4%E7%9A%84%E8%AF%B4%E6%98%8E/">某些事</a>，用我闲置的长毛象服务器，升级到了<code>main</code>分支。直接在那个服务器上测试代码修改后的效果，而不会导致我的实例崩坏。<br>我注释掉了一些代码，发现确实能够有效解除引用的限制，也粗浅地摸清了代码的原理。<br>缺点就是我之前的解除字数上限、媒体限制、置顶限制、个人资料限制、markdown魔改统统失效了。不过样式还是可以重新安装，元素宽度什么的还是要重新修改了。</p>
<h2 id="合并入主分支"><a href="#合并入主分支" class="headerlink" title="合并入主分支"></a>合并入主分支</h2><p><a href="/2025/08/17/%E9%95%BF%E6%AF%9B%E8%B1%A1%E5%A4%A7%E7%89%88%E6%9C%AC%E6%9B%B4%E6%96%B0%E8%B8%A9%E5%9D%91%E5%BF%83%E5%BE%97/">这个操作上次已经有经验</a>，还是把我的<code>custom4.4</code>分支合并到我在<code>main</code>上面新建的魔改分支上。<br>在此之前，我试过变基，但是处理冲突处理了2个小时也没看到头。所以，还是得使用合并，再全部取消暂存，然后把文件和部分文件改动，一个一个地并到新的里面去，这样还省一点时间。<br>并完提交一次，再一个个地补充没并进去的魔改。测试我是把git克隆到另一个目录里去，新开一个Vagrant测试环境进行测试的。所有功能都没问题了，再丢弃剩下的所有文件和改动。</p>
<h1 id="长毛象v4-5-x的引用功能代码和分析"><a href="#长毛象v4-5-x的引用功能代码和分析" class="headerlink" title="长毛象v4.5.x的引用功能代码和分析"></a>长毛象v4.5.x的引用功能代码和分析</h1><p>关于引用功能的全部代码魔改，都已推送到我的GitHub仓库<a target="_blank" rel="noopener" href="https://github.com/dongzhimin-xz/mastodon/tree/retoot-with-reply">https://github.com/dongzhimin-xz/mastodon/tree/retoot-with-reply</a> ，趁我还没删掉赶紧fork或克隆到本地吧</p>
<h2 id="解决网页端引用按钮被禁情况"><a href="#解决网页端引用按钮被禁情况" class="headerlink" title="解决网页端引用按钮被禁情况"></a>解决网页端引用按钮被禁情况</h2><p>找到前端的转发按钮组件<code>/app/javascript/mastodon/components/status/boost_button_utils.ts</code>，删去如下代码：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">diff --git a/app/javascript/mastodon/components/status/boost_button_utils.ts b/app/javascript/mastodon/components/status/boost_button_utils.ts</span></span><br><span class="line"><span class="comment">index 5fc77ed30..ee2b1faf9 100644</span></span><br><span class="line"><span class="comment">--- a/app/javascript/mastodon/components/status/boost_button_utils.ts</span></span><br><span class="line"><span class="comment">+++ b/app/javascript/mastodon/components/status/boost_button_utils.ts</span></span><br><span class="line"><span class="meta">@@ -145,23 +145,5 @@</span> export function quoteItemState(&#123;</span><br><span class="line">     iconComponent: FormatQuote,</span><br><span class="line">   &#125;;</span><br><span class="line"></span><br><span class="line"><span class="deletion">-  if (!isPublic &amp;&amp; !isMine) &#123;</span></span><br><span class="line"><span class="deletion">-    iconText.disabled = true;</span></span><br><span class="line"><span class="deletion">-    iconText.iconComponent = FormatQuoteOff;</span></span><br><span class="line"><span class="deletion">-    iconText.meta = messages.quote_private;</span></span><br><span class="line"><span class="deletion">-  &#125; else if (isQuoteAutomaticallyAccepted) &#123;</span></span><br><span class="line"><span class="deletion">-    iconText.title = messages.quote;</span></span><br><span class="line"><span class="deletion">-  &#125; else if (isQuoteManuallyAccepted) &#123;</span></span><br><span class="line"><span class="deletion">-    iconText.title = messages.request_quote;</span></span><br><span class="line"><span class="deletion">-    iconText.meta = messages.quote_manual_review;</span></span><br><span class="line"><span class="deletion">-    // We don&#x27;t show the disabled state when logged out</span></span><br><span class="line"><span class="deletion">-  &#125; else if (isLoggedIn) &#123;</span></span><br><span class="line"><span class="deletion">-    iconText.disabled = true;</span></span><br><span class="line"><span class="deletion">-    iconText.iconComponent = FormatQuoteOff;</span></span><br><span class="line"><span class="deletion">-    iconText.meta = isQuoteFollowersOnly</span></span><br><span class="line"><span class="deletion">-      ? messages.quote_followers_only</span></span><br><span class="line"><span class="deletion">-      : messages.quote_cannot;</span></span><br><span class="line"><span class="deletion">-  &#125;</span></span><br><span class="line"><span class="deletion">-</span></span><br><span class="line">   return iconText;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>刚才所删的代码，意思是如果符合以下条件：</p>
<ul>
<li>不是公开嘟文，且不是你发送的</li>
<li>该嘟文没被标为允许你引用（包括所有早两个月的旧版长毛象，还有外站misskey、pleroma、mitra等软件，外站的各种bot，均不允许你引用，虽然原作者并没表示拒绝你转发他&#x2F;她）</li>
</ul>
<p>你的引用按钮为灰色禁用状态，且显示“你无权引用”。只要删掉，你就可以引用嘟文，并开始编写你转评了</p>
<h2 id="解决无法发送转评的情况"><a href="#解决无法发送转评的情况" class="headerlink" title="解决无法发送转评的情况"></a>解决无法发送转评的情况</h2><p>刚才的代码改完后，你写完转评点击发送，依旧会给你提示不能引用。这说明长毛象官方的代码，把你给五花大绑🥵。接下来继续我们的逃脱表演。<br>按F12观察发现，这次发送失败，根本没有请求发送给服务端。这说明是因为前端禁止你发送转评。<br>继续修改前端代码，原理<a href="/2025/05/02/mastodon-scheduled-statuses/#Redux%E7%9A%84%E9%80%BB%E8%BE%91%E6%B5%85%E6%9E%90">我之前有提到过</a></p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">diff --git a/app/javascript/mastodon/actions/compose_typed.ts b/app/javascript/mastodon/actions/compose_typed.ts</span></span><br><span class="line"><span class="comment">index 6b38b25c2..081cd6116 100644</span></span><br><span class="line"><span class="comment">--- a/app/javascript/mastodon/actions/compose_typed.ts</span></span><br><span class="line"><span class="comment">+++ b/app/javascript/mastodon/actions/compose_typed.ts</span></span><br><span class="line"><span class="meta">@@ -170,24 +170,10 @@</span> export const quoteComposeByStatus = createAppThunk(</span><br><span class="line">       dispatch(showAlert(&#123; message: messages.quoteErrorEdit &#125;));</span><br><span class="line">     &#125; else if (composeState.get(&#x27;privacy&#x27;) <span class="comment">=== &#x27;direct&#x27;) &#123;</span></span><br><span class="line">       dispatch(showAlert(&#123; message: messages.quoteErrorPrivateMention &#125;));</span><br><span class="line"><span class="deletion">-    &#125; else if (composeState.get(&#x27;poll&#x27;)) &#123;</span></span><br><span class="line"><span class="deletion">-      dispatch(showAlert(&#123; message: messages.quoteErrorPoll &#125;));</span></span><br><span class="line">     &#125; else if (</span><br><span class="line"><span class="deletion">-      composeState.get(&#x27;is_uploading&#x27;) ||</span></span><br><span class="line"><span class="deletion">-      (mediaAttachments &amp;&amp;</span></span><br><span class="line"><span class="deletion">-        typeof mediaAttachments !== &#x27;string&#x27; &amp;&amp;</span></span><br><span class="line"><span class="deletion">-        typeof mediaAttachments !== &#x27;number&#x27; &amp;&amp;</span></span><br><span class="line"><span class="deletion">-        typeof mediaAttachments !== &#x27;boolean&#x27; &amp;&amp;</span></span><br><span class="line"><span class="deletion">-        mediaAttachments.size !== 0)</span></span><br><span class="line"><span class="addition">+      composeState.get(&#x27;is_uploading&#x27;)</span></span><br><span class="line">     ) &#123;</span><br><span class="line">       dispatch(showAlert(&#123; message: messages.quoteErrorUpload &#125;));</span><br><span class="line"><span class="deletion">-    &#125; else if (composeState.get(&#x27;quoted_status_id&#x27;)) &#123;</span></span><br><span class="line"><span class="deletion">-      dispatch(showAlert(&#123; message: messages.quoteErrorQuote &#125;));</span></span><br><span class="line"><span class="deletion">-    &#125; else if (</span></span><br><span class="line"><span class="deletion">-      status.getIn([&#x27;quote_approval&#x27;, &#x27;current_user&#x27;]) !== &#x27;automatic&#x27; &amp;&amp;</span></span><br><span class="line"><span class="deletion">-      status.getIn([&#x27;quote_approval&#x27;, &#x27;current_user&#x27;]) !== &#x27;manual&#x27;</span></span><br><span class="line"><span class="deletion">-    ) &#123;</span></span><br><span class="line"><span class="deletion">-      dispatch(showAlert(&#123; message: messages.quoteErrorUnauthorized &#125;));</span></span><br><span class="line">     &#125; else if (</span><br><span class="line">       status.get(&#x27;visibility&#x27;) <span class="comment">=== &#x27;unlisted&#x27; &amp;&amp;</span></span><br><span class="line">       !wasQuietPostHintModalDismissed</span><br></pre></td></tr></table></figure>
<p>以上被删除的代码会让你在如下情况，禁止你发送带引用嘟文：</p>
<ol>
<li>对方禁止引用时</li>
<li>你的嘟文有投票时</li>
<li>你的嘟文附加了媒体时</li>
</ol>
<p>其中<font color=49b1f5>2</font>和<font color=49b1f5>3</font>是因为长毛象官方的“极简”设计理念而禁止的。</p>
<h2 id="解决发送转评时，遭到后端拒绝的情况"><a href="#解决发送转评时，遭到后端拒绝的情况" class="headerlink" title="解决发送转评时，遭到后端拒绝的情况"></a>解决发送转评时，遭到后端拒绝的情况</h2><p>做完以上步骤后，你会发现还是无法转评。这次现象稍微有点变化，调试浏览器发现，前端确实发送了请求，但是后端还是禁止了你的引用。<br>它根本不接受你的嘟文！<br>原理<a href="/2025/05/02/mastodon-scheduled-statuses/#%E5%98%9F%E6%96%87%E5%8F%91%E9%80%81%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86">我之前也有提到过</a>，你的请求会被<code>mastodon-web.service</code>所运行的<code>puma</code>给接收，经过router，送到controller。<br>因此，找到判断审核你嘟文是否合法，并且给你返回404的那个代码，将它删掉：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">diff --git a/app/controllers/api/v1/statuses_controller.rb b/app/controllers/api/v1/statuses_controller.rb</span></span><br><span class="line"><span class="comment">index fd7757f2e..aa8f4a7ee 100644</span></span><br><span class="line"><span class="comment">--- a/app/controllers/api/v1/statuses_controller.rb</span></span><br><span class="line"><span class="comment">+++ b/app/controllers/api/v1/statuses_controller.rb</span></span><br><span class="line"><span class="meta">@@ -159,7 +159,6 @@</span> class Api::V1::StatusesController &lt; Api::BaseController</span><br><span class="line"></span><br><span class="line">   def set_quoted_status</span><br><span class="line">     @quoted_status = Status.find(status_params[:quoted_status_id])&amp;.proper if status_params[:quoted_status_id].present?</span><br><span class="line"><span class="deletion">-    authorize(@quoted_status, :quote?) if @quoted_status.present?</span></span><br><span class="line">   rescue ActiveRecord::RecordNotFound, Mastodon::NotPermittedError</span><br><span class="line">     # TODO: distinguish between non-existing and non-quotable posts</span><br><span class="line">     render json: &#123; error: I18n.t(&#x27;statuses.errors.quoted_status_not_found&#x27;) &#125;, status: 404</span><br></pre></td></tr></table></figure>
<p>这样，你的转评嘟文就可以发送了</p>
<h2 id="解决转评发送后，显示“嘟文待发布”的情况"><a href="#解决转评发送后，显示“嘟文待发布”的情况" class="headerlink" title="解决转评发送后，显示“嘟文待发布”的情况"></a>解决转评发送后，显示“嘟文待发布”的情况</h2><p>前端和后端的困境解开后，官方的代码依旧在围堵。后端代码还是会随时验证引用是否拥有原作者许可。我能做的，依旧只有不让它验证</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">diff --git a/app/services/post_status_service.rb b/app/services/post_status_service.rb</span></span><br><span class="line"><span class="comment">index 3e4a71522..ffe6fc3af 100644</span></span><br><span class="line"><span class="comment">--- a/app/services/post_status_service.rb</span></span><br><span class="line"><span class="comment">+++ b/app/services/post_status_service.rb</span></span><br><span class="line"><span class="meta">@@ -109,7 +109,7 @@</span> class PostStatusService &lt; BaseService</span><br><span class="line">     status.quote = Quote.create(quoted_status: @quoted_status, status: status)</span><br><span class="line">     status.quote.ensure_quoted_access</span><br><span class="line"></span><br><span class="line"><span class="deletion">-    status.quote.accept! if @quoted_status.local? &amp;&amp; StatusPolicy.new(@status.account, @quoted_status).quote?</span></span><br><span class="line"><span class="addition">+    status.quote.accept!</span></span><br><span class="line">   end</span><br><span class="line"></span><br><span class="line">   def safeguard_mentions!(status)</span><br></pre></td></tr></table></figure>

<h2 id="外站折中方案"><a href="#外站折中方案" class="headerlink" title="外站折中方案"></a>外站折中方案</h2><p>刚才说了，我只能让我实例的后端不验证嘟文是否经过许可，而长毛象官方不仅让长毛象的实例代码分布式验证转发许可，甚至还推动整个Fediverse社区引入这个标准来限制引用功能的使用。<br>本站引用的嘟文，如果被misskey、pleroma站点看到了，它们才不会管我的引用是否经过原作者的同意，我还是享有人权的。它们会以它们代码的方式来显示我的引用。<br>即使外站不显示我引用了啥，我还是可以让外站的Fedi友看到我引用了什么东西。运气不好，人家还可以点进原文链接进行品鉴；运气好的话，人家实例直接显示帖文预览。</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">diff --git a/app/lib/text_formatter.rb b/app/lib/text_formatter.rb</span></span><br><span class="line"><span class="comment">index 963cc0d1c..9e79fae17 100644</span></span><br><span class="line"><span class="comment">--- a/app/lib/text_formatter.rb</span></span><br><span class="line"><span class="comment">+++ b/app/lib/text_formatter.rb</span></span><br><span class="line"><span class="meta">@@ -181,7 +181,7 @@</span> class TextFormatter</span><br><span class="line">     return html if url.blank? || html.include?(url)</span><br><span class="line"></span><br><span class="line">     &lt;&lt;~HTML.squish</span><br><span class="line"><span class="deletion">-      &lt;p class=&quot;quote-inline&quot;&gt;RE: #&#123;TextFormatter.shortened_link(url)&#125;&lt;/p&gt;#&#123;html&#125;</span></span><br><span class="line"><span class="addition">+      &lt;p&gt;RE: #&#123;TextFormatter.shortened_link(url)&#125;&lt;/p&gt;#&#123;html&#125;</span></span><br><span class="line">     HTML</span><br><span class="line">   end</span><br><span class="line"> end</span><br></pre></td></tr></table></figure>
<p>我发出去的转评，它其实是自带原文链接的。只是在长毛象的外站实例，它会隐藏属性有<code>class=&quot;quote-inline&quot;</code>的元素。那我只要把自己的国籍丢掉，回国就不怕遭受暴政，还能享受外宾礼遇了🤭。</p>
<h2 id="解决上一节无法生效的bug"><a href="#解决上一节无法生效的bug" class="headerlink" title="解决上一节无法生效的bug"></a>解决上一节无法生效的bug</h2><p>将上述代码改动并入我的魔改分支后，会发现不显示我引用的原文链接了。这是因为我原先抄glitch代码时，写死了类型，也没魔改数据库，因此全部走的是<code>/app/lib/advanced_text_formatter.rb</code>（我的<a href="/2025/02/01/%E9%95%BF%E6%AF%9B%E8%B1%A1%E5%8F%91%E9%80%81markdown%E5%98%9F%E6%96%87/">魔改日记</a>也没有说明这个原理），所以官方代码改的肯定还不够，参考glitch最新版的魔改，进行代码修改：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">diff --git a/app/lib/advanced_text_formatter.rb b/app/lib/advanced_text_formatter.rb</span></span><br><span class="line"><span class="comment">index 703b44437..fc67024fb 100644</span></span><br><span class="line"><span class="comment">--- a/app/lib/advanced_text_formatter.rb</span></span><br><span class="line"><span class="comment">+++ b/app/lib/advanced_text_formatter.rb</span></span><br><span class="line"><span class="meta">@@ -69,6 +69,8 @@</span> class AdvancedTextFormatter &lt; TextFormatter</span><br><span class="line">       end</span><br><span class="line">     end</span><br><span class="line"></span><br><span class="line"><span class="addition">+    html = add_quote_fallback(html) if options[:quoted_status].present?</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line">     html.html_safe # rubocop:disable Rails/OutputSafety</span><br><span class="line">   end</span><br></pre></td></tr></table></figure>

<h2 id="解决部分外站实例导致的“嘟文已删除”问题"><a href="#解决部分外站实例导致的“嘟文已删除”问题" class="headerlink" title="解决部分外站实例导致的“嘟文已删除”问题"></a>解决部分外站实例导致的“嘟文已删除”问题</h2><p>这个问题主要出现在长毛象v4.4.x的旧版本，和新版本4.5。更旧版本的外站长毛象则不存在这个问题。<br>原因是上述实例发出请求禁止你引用。我也不废话了，不费尽心思过滤外站的拒绝引用请求，直接注释掉响应请求的吊销代码就行了。</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">diff --git a/app/models/quote.rb b/app/models/quote.rb</span></span><br><span class="line"><span class="comment">index e81d42708..22f18a693 100644</span></span><br><span class="line"><span class="comment">--- a/app/models/quote.rb</span></span><br><span class="line"><span class="comment">+++ b/app/models/quote.rb</span></span><br><span class="line"><span class="meta">@@ -51,7 +51,7 @@</span> class Quote &lt; ApplicationRecord</span><br><span class="line"></span><br><span class="line">   def reject!</span><br><span class="line">     if accepted?</span><br><span class="line"><span class="deletion">-      update!(state: :revoked)</span></span><br><span class="line"><span class="addition">+#      update!(state: :revoked)</span></span><br><span class="line">     elsif !revoked?</span><br><span class="line">       update!(state: :rejected)</span><br><span class="line">     end</span><br></pre></td></tr></table></figure>
<p>这样，外站被引用的长毛象用户，点击了删除本站某用户的引用，也不会影响到本站了。其他长毛象实例，包括v4.4.x还是受影响的，除非他们也废了象的武功。</p>
<h2 id="解决长毛象（手机）客户端无法引用大部分嘟文的问题"><a href="#解决长毛象（手机）客户端无法引用大部分嘟文的问题" class="headerlink" title="解决长毛象（手机）客户端无法引用大部分嘟文的问题"></a>解决长毛象（手机）客户端无法引用大部分嘟文的问题</h2><p>刚才的一系列操作，可以让本站用户在<strong>网页端</strong>尽情转评别人的嘟文了，但是手机客户端仍然受限制，可能使用了其他前端也会有前端上的限制。<br>还有个很神奇的现象，当我登录旧版长毛象（v4.3.x）实例上的账号时，我的IceCube可以引用，但是新版实例的账号就无法引用别人的嘟文了。真的是v4.5的用户连畜生都不如😅<br><img src="beat-foreigners.png" alt="v4.5用户与狗不得入内"></p>
<blockquote>
<p>毛象（前朝公民除外）与狗不得入内</p>
</blockquote>
<p>本节的魔改，不能让用户在别人的前端、官方客户端、第三方客户端直接引用v4.5用户禁止引用的嘟文。<br>原理很简单：把后端推到客户端的外站非长毛象嘟文，全都改成“自动批准转发”就行了</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">diff --git a/app/models/concerns/status/interaction_policy_concern.rb b/app/models/concerns/status/interaction_policy_concern.rb</span></span><br><span class="line"><span class="comment">index da132a450..7f369701b 100644</span></span><br><span class="line"><span class="comment">--- a/app/models/concerns/status/interaction_policy_concern.rb</span></span><br><span class="line"><span class="comment">+++ b/app/models/concerns/status/interaction_policy_concern.rb</span></span><br><span class="line"><span class="meta">@@ -65,7 +65,7 @@</span> module Status::InteractionPolicyConcern</span><br><span class="line"></span><br><span class="line">     return :unknown if (automatic_policy | manual_policy).anybits?(QUOTE_APPROVAL_POLICY_FLAGS[:unsupported_policy])</span><br><span class="line"></span><br><span class="line"><span class="deletion">-    :denied</span></span><br><span class="line"><span class="addition">+    :automatic</span></span><br><span class="line">   end</span><br><span class="line"></span><br><span class="line">   def downgrade_quote_policy</span><br></pre></td></tr></table></figure>

<h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>我觉得我这一篇博客对于毛象的魔改也没太大贡献，但是最值得肯定的一点就在于给毛象用户找回一点尊严。</p>
<p>这就让人联想到，最近<a target="_blank" rel="noopener" href="http://archive.today/mN2m0">武统台湾</a>的<a target="_blank" rel="noopener" href="https://web.archive.org/web/20251123144454/https://mastodon.antisocial.science/@lmet/115588219978259180">呼声很高</a>，有网友就给出了非常中肯的<a target="_blank" rel="noopener" href="https://annihilation.social/objects/dfb0bbfd-3e03-4666-85be-38529737600e">回复</a></p>
<blockquote>
<p>正所谓赢了有台湾岛，输了有新中国，这是真正的双赢——这下不得不支持了。</p>
</blockquote>
<p>中国人就像小黄人找老大一样，到处拜青天大老爷。在幻想中，拜包青天。在缺粮食的时候，拜大贤良师，给自己喂粥。现在中国人缺的是尊严，没有尊严（例如把你打得一辈子下不了床，你虽然没有失去生命，但是这叫失去尊严，跟死了没两样）也跟活活饿死一样没有区别。平时加班到深夜，回家路上看到一堆我国“尊贵的客人”在地铁上拉屎撒尿没人管，你拿出水喝一口，警察马上就来对你罚款，回头再叫那几位贵宾给点面子，直接放走。第二天上班，早高峰，你好不容易找到座位，坐上去睡一会儿，警察上来一巴掌把你打醒，叫你给边上的外国人让座，“要发扬待客之道”。你说你站不起来，晶哥就连拖带拽地拉你去局子里坐坐。老外说：“别打了，多难看啊，我前两天刚入籍了台湾，不是客人了😀”晶哥说：“台湾？台湾也事外宾！”于是把你逮捕了。这时，你是否也想要一个能给你施舍点尊严的青天大老爷或者亭长呢？🙂</p>
<p>话说回来，把这段代码抄去，你这个站长也是得到了自己的赛博《太平要术》（东汉末年的启示录）😈</p>
</div><div class="post-copyright"><div class="post-copyright-author"><span class="post-copyright-meta">本文作者: </span><span class="post-copyright-info"><a href="mailto:undefined">妙瓦草</a></span></div><div class="post-copyright-type"><span class="post-copyright-meta">本文链接: </span><span class="post-copyright-info"><a href="https://blog.xuzhou-jiang.su/2025/11/23/mastodon-quote/">https://blog.xuzhou-jiang.su/2025/11/23/mastodon-quote/</a></span></div><div class="post-copyright-notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本站点所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.xuzhou-jiang.su">妙瓦种子</a>！</span></div></div><div class="post-copyright valine" id="comments-container"><script src="//unpkg.com/valine@1.4.14/dist/Valine.min.js"></script><script>let arr = location.href.split('/#more')[0].split('/');
let title = arr[arr.length - 1];
if (title === '') {
    title = arr[arr.length - 2];
}
var flag = false;
var gitFun = function () {
    try {
        var valineObj = window.GLOBAL_CONFIG.valine;
        new Valine({
            el: "#comments-container",
            ...valineObj
        });
        flag = true;
    } catch (e) {
        flag = false;
    }
}
var setIn = setInterval(() => {
    if (!flag) {
        gitFun();
    } else {
        clearInterval(setIn);
    }
}, 200);</script></div></article><div id="pagination"><div class="prev-post pull-left"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="../../../12/28/A-A-A/"><i class="fas fa-angle-left">&nbsp;</i><span>美国反对美国</span></a></div><div class="next-post pull-right"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="../../../09/01/mastodon-markdown-codeblock-highlight/"><span>长毛象markdown代码块高亮</span><span>&nbsp;</span><i class="fas fa-angle-right"></i></a></div></div><!--div!= paginator()--></div></div><div class="button-hover" id="return-top"><i class="fas fa-arrow-up" aria-hidden="true"></i></div><footer><div id="footer"><div class="button-hover" id="side-button"><i class="fas fa-arrow-right"></i></div><div class="right-content"><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fas fa-file-o"></i></span><span id="busuanzi_value_page_pv"></span><span></span></div><div class="copyright">&copy;2017 ～ 2026 By 妙瓦草</div></div></div></footer></div><!--js(src=url_for(url) + '?version=' + version())--><script src="../../../../js/thirdparty/jquery-3.3.1.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="../../../../js/thirdparty/velocity.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="../../../../js/thirdparty/jquery.mCustomScrollbar.concat.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="../../../../js/fan.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="../../../../js/canvas_bg.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="../../../../js/utils.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="../../../../js/scroll.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="../../../../js/sidebar.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="../../../../js/copy.js"></script><!--script(src=url)--><div class="search-dialog"><div id="algolia-search-title">Algolia</div><div class="search-close-button"><i class="fa fa-times"></i></div><!--div#current-refined-values--><!--div#clear-all--><div id="search-box"></div><!--div#refinement-list--><hr><div id="hits"></div><div id="algolia-pagination"></div></div><div class="search-mask"></div><script src="../../../../js/search/algolia.js"></script></body></html>