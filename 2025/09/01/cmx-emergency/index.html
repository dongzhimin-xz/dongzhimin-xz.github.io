<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="长毛象域名失效急救处理"><meta name="keywords" content="坚决捍卫言论自由！,长毛象运维,网络安全,节目效果拉满"><meta name="author" content="妙瓦草,undefined"><meta name="copyright" content="妙瓦草"><meta name="fediverse:creator" content="@Network@cmx.xuzhou-jiang.su"><link rel="me" href="https://cmx.xuzhou-jiang.su/@Network"><title>长毛象域名失效急救处理【妙瓦种子】</title><link rel="stylesheet" href="../../../../css/fan.css"><link rel="stylesheet" href="../../../../css/thirdparty/jquery.mCustomScrollbar.min.css"><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"><link rel="icon" href="../../../../favicon.ico"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch-theme-algolia.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4"></script><!-- link(rel="dns-prefetch" href="https://cdn.jsdelivr.net")--><!-- link(rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css")--><!-- script(src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer)--><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- script(src=url_for("/js/mathjax/mathjax.js"))--><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
});
</script><script>var isPassword = '' || false;
if (isPassword) {
    if (prompt('请输入文章密码') !== '') {
        alert('密码错误！');
        history.back();
    }
}</script><script>window.GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"BLFJMI3OZT","apiKey":"bfca30d788c8947af1865ed33655b646","indexName":"blog","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  gitment: {},
  valine: {"appId":"xASAWVJMlgR6Z0IAumJosLmQ-MdYXbMMI","appKey":"hrSzqoj09CVByDzUeBMDEjuF","serverURLs":"https://xasawvjm.api.lncldglobal.com"},
  twikoo: {},
}</script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="atom.xml" title="妙瓦种子" type="application/atom+xml">
</head><body><canvas id="universe"></canvas><!--#body--><div id="sidebar"><div class="toggle-sidebar-info button-hover"><span data-toggle="文章目录">站点概览</span></div><div class="sidebar-toc"><div class="sidebar-toc-title">目录</div><div class="sidebar-toc-progress"><span class="progress-notice">您已阅读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc-progress-bar"></div></div><div class="sidebar-toc-content" id="sidebar-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C"><span class="toc-number">2.</span> <span class="toc-text">实验</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E5%86%85%E5%AE%B9"><span class="toc-number">2.1.</span> <span class="toc-text">实验内容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E7%BB%93%E6%9E%9C"><span class="toc-number">2.2.</span> <span class="toc-text">实验结果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E5%8E%9F%E7%90%86%EF%BC%88%E6%8E%A8%E6%B5%8B%EF%BC%89"><span class="toc-number">2.3.</span> <span class="toc-text">实验原理（推测）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E6%93%8D%E4%BD%9C"><span class="toc-number">3.</span> <span class="toc-text">实际操作</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AF%B9%E8%B4%A6%E5%8F%B7%E5%AE%89%E5%85%A8%E7%9A%84%E5%8F%8D%E6%80%9D%E5%92%8C%E5%A4%8D%E7%9B%98"><span class="toc-number">4.</span> <span class="toc-text">对账号安全的反思和复盘</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%A4%87%E4%BB%BD"><span class="toc-number">4.1.</span> <span class="toc-text">数据库的备份</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%81%E4%B9%A6%E7%9A%84%E5%A4%87%E4%BB%BD"><span class="toc-number">4.2.</span> <span class="toc-text">证书的备份</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E6%B3%A8%E5%86%8C%E7%BD%91%E7%AB%99%E7%AC%AC%E4%B8%89%E6%96%B9%E6%9C%8D%E5%8A%A1%E7%94%A8%E7%9A%84%E9%82%AE%E7%AE%B1"><span class="toc-number">4.3.</span> <span class="toc-text">关于注册网站第三方服务用的邮箱</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info-avatar"><img class="author-info-avatar-img" src="/avatar.jpg"></div><div class="author-info-name">妙瓦草</div><div class="author-info-description"></div><div class="links-buttons"><a class="links-button button-hover" href="https://github.com/dongzhimin-xz" target="_blank">GitHub<i class="icon-dot bg-color8"></i></a><a class="links-button button-hover" href="https://cmx.xuzhou-jiang.su/@Network" target="_blank">长毛象<i class="icon-dot bg-color5"></i></a><a class="links-button button-hover" href="https://bsky.app/profile/dzm.pp.ua" target="_blank">BlueSky<i class="icon-dot bg-color9"></i></a></div><div class="author-info-articles"><a class="author-info-articles-archives article-meta" href="../../../../archives"><span class="pull-top">日志</span><span class="pull-bottom">20</span></a><a class="author-info-articles-tags article-meta" href="../../../../tags"><span class="pull-top">标签</span><span class="pull-bottom">35</span></a><a class="author-info-articles-categories article-meta" href="../../../../categories"><span class="pull-top">分类</span><span class="pull-bottom">28</span></a></div><div class="friend-link"><a class="friend-link-text" href="https://xuzhou-jiang.su/" target="_blank">个人主页</a><a class="friend-link-text" href="https://cmx.xuzhou-jiang.su/" target="_blank">长毛象实例</a></div></div></div><div id="main-container"><header><div id="menu-outer"><i class="menu-list-icon fas fa-bars"></i><nav id="menu-inner"><a class="menu-item" href="/">首页</a><a class="menu-item" href="/tags">标签</a><a class="menu-item" href="/categories">分类</a><a class="menu-item" href="/archives">归档</a><a class="menu-item" href="/about">关于</a></nav><div class="right-info"><a class="search social-icon"><i class="fas fa-search"></i><span> 搜索</span></a><a class="title-name" href="/">妙瓦种子</a><span id="now-time"></span></div></div></header><div id="content-outer"><div id="content-inner"><article id="post"><div class="post-header"><div class="title">长毛象域名失效急救处理</div><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 发表于 2025-09-01 | 更新于 2025-09-01</time><!--time.button-hover.post-date #[i.fas.fa-calendar-alt.article-icon(aria-hidden="true")] #[=__('post.modified')] #[=date(page['updated'], config.date_format)]--><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="../../../../categories/%E5%BB%BA%E7%AB%99%E6%8A%80%E6%9C%AF/">建站技术</a><i class="fa fa-angle-right" style="margin: 0 8px;"></i><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="../../../../categories/%E5%BB%BA%E7%AB%99%E6%8A%80%E6%9C%AF/%E9%95%BF%E6%AF%9B%E8%B1%A1%E5%AE%9E%E4%BE%8B%E8%BF%90%E7%BB%B4/">长毛象实例运维</a><i class="fa fa-angle-right" style="margin: 0 8px;"></i><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="../../../../categories/%E5%BB%BA%E7%AB%99%E6%8A%80%E6%9C%AF/%E9%95%BF%E6%AF%9B%E8%B1%A1%E5%AE%9E%E4%BE%8B%E8%BF%90%E7%BB%B4/%E9%95%BF%E6%AF%9B%E8%B1%A1%E6%80%A5%E6%95%91%E5%A4%84%E7%90%86/">长毛象急救处理</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="../../../../tags/%E5%9D%9A%E5%86%B3%E6%8D%8D%E5%8D%AB%E8%A8%80%E8%AE%BA%E8%87%AA%E7%94%B1%EF%BC%81/">坚决捍卫言论自由！</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="../../../../tags/%E9%95%BF%E6%AF%9B%E8%B1%A1%E8%BF%90%E7%BB%B4/">长毛象运维</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="../../../../tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">网络安全</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="../../../../tags/%E8%8A%82%E7%9B%AE%E6%95%88%E6%9E%9C%E6%8B%89%E6%BB%A1/">节目效果拉满</a></div></div></div><div class="main-content"><p>刚才我写过一篇文章，<a href="/2025/08/31/%E5%85%B3%E4%BA%8E%E6%9C%80%E8%BF%91%E5%81%9C%E6%9B%B4%E7%9A%84%E8%AF%B4%E6%98%8E/">关于站点的情况说明</a>，挂人并不是为了泄愤，也不是最终目的，而是本篇重要博客的基础，以及将来我写保姆级教程的典型案例。</p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>天塌了！天塌了！就在刚才，我们的毛象圈子似乎又出事了。什么都别废话，看图</p>
<span id="more"></span>
<p><img src="domain-failed.png" alt="笨蛋冰的域名"><br><em>结合王畅睿天天不上学，开小号到处蹦跶的嚣张嘴脸，不得不追杀。（当然，这个图里的杰作，也不清楚是不是他干的，但他似乎已经认领了这起恐怖袭击）</em><br>之前收到乌克兰域名注册局的通知，我就知道要寄了。但我绝对不可能让王某称心如意，就此退网。我的路又两条，最亏的一条：买一个新的域名，抽空从头重新建个实例，我这好不容易攒的100多个粉丝全部放弃。更可恶的是，要把我这一年的上万条嘟文都给放弃，这些除了有让敌人害怕的内容，还要很多一旦失去就要找很久的，甚至绝版的技术踩坑指南！</p>
<blockquote>
<p><font color=yellow><strong>屈服于强权而放弃粉丝和自己的所有嘟文，这TM不就跟推特一样了吗！</strong> </font></p>
</blockquote>
<p>还有一条路，就是把粉丝迁移到其他站点，本站修改<code>LOCAL_DOMAIN</code>环境变量以后，再迁移回本站。这可以最大程度地挽回损失。</p>
<h1 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h1><p>迁移账号，必定会造成损失，一个是30天的冷却期，如果失败，将无法重试迁移；另一个是必定有部分粉丝带不走，ta们是bot，或者实例（暂时）跑路了。<br>我开启我的闲置VPS，之前也是运行长毛象实例的，让它重新运行了长毛象实例。<br>我在接到通知后，第一时间就买了几个域名。在群里找笨蛋冰咨询了哪里有防投诉域名和防投诉服务器卖。拿了一些看着不太宝贵的域名，完成解析，全新配置了实例。</p>
<h2 id="实验内容"><a href="#实验内容" class="headerlink" title="实验内容"></a>实验内容</h2><p>拿旧站当逃生舱，新站模拟域名停止解析状况。迁移的粉丝，就用我那几十个小号。</p>
<h2 id="实验结果"><a href="#实验结果" class="headerlink" title="实验结果"></a>实验结果</h2><p>可以迁移。首先，迁出时不能修改<code>LOCAL_DOMAIN</code>，但要添加<code>ALTERNATE_DOMAINS</code>，这样用户才能登录。然后新账号要把旧帐号设置为别名。更改<code>LOCAL_DOMAIN</code>后，实例将无法收到一切站外嘟文。除非，取关并重新关注，中继站也都禁用并重新启用。</p>
<h2 id="实验原理（推测）"><a href="#实验原理（推测）" class="headerlink" title="实验原理（推测）"></a>实验原理（推测）</h2><p>旧帐号所在实例，按照旧帐号的粉丝列表，给所有粉丝发送取关自己，关注新账号的请求。这其中，旧帐号用webfinger去点粉丝，而粉丝却不必用webfinger点旧帐号来验证（旧帐号由于失去旧域名的解析，无法被webfinger触及。而且这个bug肯定不可能修，不然我可以反过来强制禁止人家外站用户对我拉黑取关了）。<br>旧实例修改<code>LOCAL_DOMAIN</code>后，以前的关注和中继依旧是要照常给它发送消息，但是找不到主机。只有重新关注和重新加入中继后，旧实例把新的webfinger地址告诉联合内的其他实例，它们把旧实例当成了一个有25年工作经验的应届生罢了。这很正常，这BUG也不可能修掉，不然你说为什么长毛象没从第一版公测到v4.4，也没把域名写死到数据库里去？<br>新账号迁回改名后的旧实例也非常顺利。</p>
<h1 id="实际操作"><a href="#实际操作" class="headerlink" title="实际操作"></a>实际操作</h1><p>我备份服务器后，将主账号粉丝全部迁移，共迁移成功80多粉丝。1天后改名操作，重新加入中继，取关一切并重新导入。现在账号跟没事人一样。<br>但是，有些小问题，我的测试账号，无法将粉丝迁移到外站，主要卡在设置别名时，所有外站账号提示找不到此账号。这说明账号没有联合，基本上不必怀疑象友把我小号封了。</p>
<h1 id="对账号安全的反思和复盘"><a href="#对账号安全的反思和复盘" class="headerlink" title="对账号安全的反思和复盘"></a>对账号安全的反思和复盘</h1><p>平时要做好数据库和证书的备份。</p>
<h2 id="数据库的备份"><a href="#数据库的备份" class="headerlink" title="数据库的备份"></a>数据库的备份</h2><p>这次王畅睿也举报了我的VPS，侥幸没被删。失去了便宜的VPS事小，我账号上的数据事大。所以得参考这个教程 <a target="_blank" rel="noopener" href="https://www.eallion.com/mastodon-backup/">https://www.eallion.com/mastodon-backup/</a> ，每天全自动把数据库备份到存储桶。详细操作，我是简化了很多倍的，用更笨的办法来备份。而且我也觉得这象友的脚本可以加些个<code>&amp;</code>和<code>wait;</code>，显得更优雅。</p>
<h2 id="证书的备份"><a href="#证书的备份" class="headerlink" title="证书的备份"></a>证书的备份</h2><p>每两个月，实例都必须刷新证书，因为3个月就过期了。每次执行刷新的<code>crontab</code>时，还应该顺带把证书备份到存储桶去。这是为了在备用实例无法添加别名时，可以拿还有余温的旧证书来联合旧实例。<br>就在刚才，我还发现了一招，还没试过的办法，利用<code>ALLOWED_PRIVATE_ADDRESSES</code>和<a target="_blank" rel="noopener" href="https://github.com/mastodon/mastodon/blob/main/app/lib/private_address_check.rb#L6">这段代码</a>来进行http连接。把旧实例的IP地址加入到<a target="_blank" rel="noopener" href="https://github.com/mastodon/mastodon/blob/main/app/lib/private_address_check.rb#L6">这段代码</a>里，或许能实现很多神奇的功能。</p>
<p>我觉得<code>rclone</code>比<code>aws-cli</code>更好用，因为b2存储桶用<code>aws-cli</code>得加额外配置，否则会报错。</p>
<h2 id="关于注册网站第三方服务用的邮箱"><a href="#关于注册网站第三方服务用的邮箱" class="headerlink" title="关于注册网站第三方服务用的邮箱"></a>关于注册网站第三方服务用的邮箱</h2><p>我发现还是需要用公共邮箱，就比如gmail.com和protonmail比较好，而不是用自己域名的邮箱。用自己域名的邮箱，虽然没人知道我身份，但很多服务改不了邮箱，甚至登录不进去。<br><img src="larksuite.png" alt="我飞书被封了😭"></p>
<p>用gmail这种公共邮箱，隐私性差了一点，还是可能会被俄苏狗开盒，如果你拿干这个用的邮箱，同时来注册腾讯相关账号和b站的话，都是实名的，还经常脱库。<br>我认为最好的办法，还是多注册几个域名，部分域名负责岁静，专门用来给自己转发密码管理器和注册服务用。</p>
<p>对于如何选购服务器，再搞个域名，我有空再写个保姆级教程。很快就来了</p>
<p>——————更新————————<br>原来开头那个页面是笨蛋冰自己弄的，<a href="/tags/%E8%8A%82%E7%9B%AE%E6%95%88%E6%9E%9C%E6%8B%89%E6%BB%A1/">节目效果拉满</a>了属于是</p>
</div><div class="post-copyright valine" id="comments-container"><script src="//unpkg.com/valine@1.4.14/dist/Valine.min.js"></script><script>let arr = location.href.split('/#more')[0].split('/');
let title = arr[arr.length - 1];
if (title === '') {
    title = arr[arr.length - 2];
}
var flag = false;
var gitFun = function () {
    try {
        var valineObj = window.GLOBAL_CONFIG.valine;
        new Valine({
            el: "#comments-container",
            ...valineObj
        });
        flag = true;
    } catch (e) {
        flag = false;
    }
}
var setIn = setInterval(() => {
    if (!flag) {
        gitFun();
    } else {
        clearInterval(setIn);
    }
}, 200);</script></div></article><div id="pagination"><div class="prev-post pull-left"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="../mastodon-code-test/"><i class="fas fa-angle-left">&nbsp;</i><span>长毛象代码测试（初步）</span></a></div><div class="next-post pull-right"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="../../../08/31/mCustomScrollbar%E8%B0%83%E6%95%B4%E9%BC%A0%E6%A0%87%E6%BB%9A%E8%BD%AE%E7%81%B5%E6%95%8F%E5%BA%A6/"><span>mCustomScrollbar调整鼠标滚轮灵敏度</span><span>&nbsp;</span><i class="fas fa-angle-right"></i></a></div></div><!--div!= paginator()--></div></div><div class="button-hover" id="return-top"><i class="fas fa-arrow-up" aria-hidden="true"></i></div><footer><div id="footer"><div class="button-hover" id="side-button"><i class="fas fa-arrow-right"></i></div><div class="right-content"><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fas fa-file-o"></i></span><span id="busuanzi_value_page_pv"></span><span></span></div><div class="copyright">&copy;2025 By 妙瓦草</div></div></div></footer></div><!--js(src=url_for(url) + '?version=' + version())--><script src="../../../../js/thirdparty/jquery-3.3.1.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="../../../../js/thirdparty/velocity.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="../../../../js/thirdparty/jquery.mCustomScrollbar.concat.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="../../../../js/fan.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="../../../../js/canvas_bg.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="../../../../js/utils.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="../../../../js/scroll.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="../../../../js/sidebar.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="../../../../js/copy.js"></script><!--script(src=url)--><div class="search-dialog"><div id="algolia-search-title">Algolia</div><div class="search-close-button"><i class="fa fa-times"></i></div><!--div#current-refined-values--><!--div#clear-all--><div id="search-box"></div><!--div#refinement-list--><hr><div id="hits"></div><div id="algolia-pagination"></div></div><div class="search-mask"></div><script src="../../../../js/search/algolia.js"></script></body></html>